<!doctype html>
const union = A.size + B.size - inter;
score = union ? inter/union : 0;
}
topMatches.push({ r, score, maybeConflict });
}


topMatches.sort((a,b) => b.score - a.score);
const strong = topMatches.filter(x => x.score >= 0.85 || (x.maybeConflict && x.score >= 0.75));
const medium = topMatches.filter(x => x.score >= 0.65 && x.score < 0.85);


if (strong.length) {
availabilityNote.innerHTML = `<div class="badge badge-red">${L.conflict_high}</div>`;
} else if (medium.some(x => x.maybeConflict)) {
availabilityNote.innerHTML = `<div class="badge badge-amber">${L.conflict_medium}</div>`;
} else {
availabilityNote.innerHTML = `<div class="badge badge-green">${L.available}</div>`;
}


// Show top 5 matches
const top5 = topMatches.slice(0, 5);
conflictsBox.innerHTML = top5.map(({r, score}) => `
<div class="mt-2 p-2 rounded-lg border bg-gray-50">
<div class="text-xs text-gray-500">similarity: ${(score*100).toFixed(1)}%</div>
<div class="font-medium">${escapeHtml(r.TopicTitle)} — <span class="text-gray-600">${escapeHtml(r.Teacher)}</span></div>
<div class="text-sm">${escapeHtml(r.Dataset)} ${r.DatasetLink ? `<a href="${r.DatasetLink}" target="_blank" class="text-blue-700 underline">↗</a>` : ''}</div>
<div class="text-sm text-gray-700">${escapeHtml(r.Goal)}</div>
</div>
`).join('');
});


addBtn.addEventListener('click', async () => {
addStatus.textContent = '';
const payload = {
StudentName: input.studentName.value.trim(),
StudentID: input.studentId.value.trim(),
Email: input.email.value.trim(),
Program: input.program.value.trim(),
TopicTitle: input.topicTitle.value.trim(),
Dataset: input.dataset.value.trim(),
DatasetLink: input.datasetLink.value.trim(),
Goal: input.goal.value.trim(),
Teacher: input.teacher.value.trim(),
Status: 'Booked',
Notes: ''
};


try {
const form = new URLSearchParams();
form.set('token', my-secret-123);
form.set('data', JSON.stringify(payload));


const res = await fetch(https://script.google.com/macros/s/AKfycbyTENhmWhX50XqqOrrQehbrq5RGvh-wgVfX2pEIYTcbqcZkGZ3eUsuGUnC0-D-TPrxw/exec, {
method: 'POST',
headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
body: form.toString(),
});
const data = await res.json();
if (data && data.ok) {
addStatus.className = 'text-green-700';
addStatus.textContent = i18n[document.getElementById('lang').value].added;
await loadRows();
} else {
throw new Error('API error');
}
} catch (err) {
addStatus.className = 'text-red-700';
addStatus.textContent = i18n[document.getElementById('lang').value].add_error;
console.error(err);
}
});


// Init
loadRows();
</script>
</body>
</html>
